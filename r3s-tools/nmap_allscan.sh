# /bin/#!/usr/bin/env bash

echo "          $$$$$$\               "
echo "         $$ ___$$\              "
echo "   $$$$$$\\_/   $$ | $$$$$$$\   "
echo "  $$  __$$\ $$$$$ / $$  _____|  "
echo "  $$ |  \__|\___$$\ \$$$$$$\    "
echo "  $$ |    $$\   $$ | \____$$\   "
echo "  $$ |    \$$$$$$  |$$$$$$$  |  "
echo "  \__|     \______/ \_______/   "
echo "                                "
echo "                                "
echo "                                "

echo "------------------------------------------------------"
echo "Nmap One-off Scan"
echo "Author: risk3sixty"
echo "Contributors: Ryan"
echo "------------------------------------------------------"
echo " "
echo " "

# Variable declarations
echo "Please enter client name (one word)"
read -p 'Client: ' CLIENT
echo "Please enter IP range (according to scope)"
read -p 'IP range: ' IPRANGE

echo "------------------------------------------------------"
echo "Starting Nmap scan..."
echo "------------------------------------------------------"

# Nmap scan for specific protocols on specific ports
# with output to client-specific file
nmap -oA $CLIENT_$IPRANGE --stats-every 60s --log-errors --traceroute --reason --randomize-hosts -v -R -PE -PP -PM -PO -PU -PY80,23,443,21,22,25,3389,110,445,139 -PS80,23,443,21,22,25,3389,110,445,139,143,53,135,3306,8080,1723,111,995,993,5900,1025,587,8888,199,1720,465,548,113,81,6001,10000,514,5060,179,1026,2000,8443,8000,32768,554,26,1433,49152,2001,515,8008,49154,1027,5666,646 -PA80,23,443,21,22,25,3389,110,445,139,143,53,135,3306,8080,1723,111,995,993,5900,1025,587,8888,199,1720,465,548,113,81,6001,10000,514,5060,179,1026,2000,8443,8000,32768,554,26,1433,49152,2001,515,8008,49154,1027,5666,646 -sS -sV -p21,22,23,25,80,443,8080,8443 $IPRANGE

# Create the hosts file based on results from above scan
# that returned open or closed results for at least one port
echo "------------------------------------------------------"
echo "Creating host file for targeting..."
echo "------------------------------------------------------"
cat $CLIENT_$IPRANGE.gnmap | grep -E 'open|closed' | grep -o '[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}' > $CLIENT_Hosts.txt

# Nmap scan for TCP alive hosts
echo "------------------------------------------------------"
echo "Scanning host list for TCP services on alive hosts..."
echo "------------------------------------------------------"
nmap -oA $CLIENT_tcp_alive --stats-every 60s --log-errors --reason --randomize-hosts -v -R -Pn -A -sSVC -p0- -iL $CLIENT_Hosts.txt

# Nmap scan for UDP alive hosts
echo "------------------------------------------------------"
echo "Scanning host list for UDP services on alive hosts..."
echo "------------------------------------------------------"
nmap -oA $CLIENT_udp_alive --stats-every 60s --log-errors --reason --randomize-hosts -v -R -Pn -sUVC --top-ports 100 -iL $CLIENT_Hosts.txt

# Nmap scan for common vulnerabilities
echo "------------------------------------------------------"
echo "Scanning for common vulnerabilities..."
echo "------------------------------------------------------"
nmap --script vuln $CLIENT_Hosts.txt

# Nmap scan for printers
echo "------------------------------------------------------"
echo "Scanning for printers..."
echo "------------------------------------------------------"
nmap -oA $CLIENT_$IPRANGE_printers -sS -p9100,515,631 -iL $CLIENT_Hosts.txt

echo "Scans finished. The following files have been created for analysis:"
